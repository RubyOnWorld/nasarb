#! /usr/bin/env ruby

# Main fUnit routine

$:.push "#{File.dirname $0}/../lib"
require 'funit'
require 'optparse'
require 'ostruct'

include Funit

funit_data = OpenStruct.new
funit_data.prog_source_dirs = ['.']
funit_data.c_code = Funit::C_compile.new
  
OptionParser.new do |opts|
  opts.banner = <<-END_OF_HELP
        To use fUnit, type:
          funit [-options] [test_file_name(s)]
        The argument(s) is optional. If no argument is given, then all the .fun files inside the working directory will be used.
      END_OF_HELP
      
  opts.separator ""
  opts.separator "Specific options:"
  
  opts.on("-s","--source <dir>",String,"Specify a directory for the non-test source") do |dir|
    funit_data.prog_source_dirs << dir.chomp("/")
  end
  
  opts.on("-l","--link_c_code <dir>",String,"Specify a directory of C/C++ code that must be compiled/linked") do |dir|
    funit_data.c_code.compile_library(dir)
  end
  
  opts.on_tail("--clean","To remove the files generated by funit") do 
    funit_data.c_code.clean_c_code
    Funit::clean_genFiles
    exit
  end
  
  opts.separator ""
  opts.separator "Common options:"
  
  opts.on_tail("-v","--version","Print version") do 
    puts "funit version #{Funit::VERSION}"
    exit
  end
  
 opts.on_tail("-h", "--help", "Detailed overview of funit options") do
   puts opts
   exit
 end

end.parse!

funit_data.prog_source_dirs.flatten!
funit_data.prog_source_dirs.uniq!

Funit::check_for_FSFLAG

Funit::run_tests(funit_data)

#--
# Copyright 2006-2007 United States Government as represented by
# NASA Langley Research Center. No copyright is claimed in
# the United States under Title 17, U.S. Code. All Other Rights
# Reserved.
#
# This file is governed by the NASA Open Source Agreement.
# See License.txt for details.
#++
